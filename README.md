<div contenteditable="true" translate="no" class="ProseMirror"><h1>Conector de Koha para Midpoint</h1><p>Conector de identidades para <strong>Evolveum Midpoint</strong> que permite la gesti√≥n del ciclo de vida de usuarios (Patrones) en el <strong>Sistema Integrado de Gesti√≥n de Bibliotecas (ILS) Koha</strong>.</p><p>Este conector utiliza la API REST de Koha y ha sido desarrollado siguiendo las mejores pr√°cticas del Identity Connector Framework (ConnId).</p><h2>‚ú® Caracter√≠sticas Principales</h2><ul><li><p><strong>Gesti√≥n Completa de Patrones:</strong> Soporte para operaciones de Creaci√≥n (<code>Create</code>), Lectura/B√∫squeda (<code>Search</code>), Actualizaci√≥n (<code>Update</code>) y Eliminaci√≥n (<code>Delete</code>).</p></li><li><p><strong>Autenticaci√≥n Flexible:</strong> Compatibilidad con autenticaci√≥n <strong>B√°sica</strong> (usuario/contrase√±a) y <strong>OAuth2</strong> (Client Credentials) para una integraci√≥n segura.</p></li><li><p><strong>Arquitectura Robusta y Mejorada:</strong> El c√≥digo sigue un dise√±o modular que separa responsabilidades (autenticaci√≥n, servicios, mapeo de datos) y ha sido refactorizado para mejorar la robustez, el manejo de errores y la mantenibilidad.</p></li><li><p><strong>B√∫squeda por Atributos:</strong> Permite buscar usuarios en Koha por UID, <code>userid</code>, <code>email</code> y <code>cardnumber</code> directamente desde Midpoint.</p></li></ul><h2>üìã Requisitos Previos</h2><ul><li><p><strong>Java</strong> Development<strong> Kit (JDK):</strong> Se recomienda usar versiones <strong>8, 11 o 17</strong>. El proyecto est√° configurado para compilar con Java 1.8, pero es compatible con versiones LTS m√°s recientes. Versiones muy nuevas (ej. JDK 24+) pueden causar errores durante la fase de pruebas debido a incompatibilidades con las dependencias.</p></li><li><p><strong>Apache Maven:</strong> Versi√≥n 3.6.3 o superior.</p></li></ul><h2>üöÄ Instalaci√≥n</h2><ol><li><p><strong>Descargar el Conector:</strong> Ve a la secci√≥n de <a href="https://github.com/UPeU-CRAI/connector-koha/releases" title="null"><strong>Releases</strong></a> de este repositorio y descarga el archivo <code>.jar</code> de la √∫ltima versi√≥n (ej. <code>connector-koha-1.0.1.jar</code>).</p></li><li><p><strong>Desplegar en Midpoint:</strong> Copia el archivo <code>.jar</code> descargado en el directorio de conectores de tu instancia de Midpoint:</p><pre><code>cp connector-koha-1.0.1.jar $MIDPOINT_HOME/var/icf-connectors/
<br class="ProseMirror-trailingBreak"></code></pre></li><li><p><strong>Reiniciar Midpoint:</strong> Reinicia el servicio de Midpoint para que detecte el nuevo conector.</p></li></ol><h2>‚öôÔ∏è Configuraci√≥n del Recurso en Midpoint</h2><p>Una vez instalado, puedes crear un nuevo recurso en Midpoint. Aqu√≠ tienes un ejemplo de la secci√≥n <code>&lt;connectorConfiguration&gt;</code> que debes usar.</p><pre><code>&lt;connectorConfiguration&gt;
    &lt;icfc:configurationProperties xmlns:icfc="[http://midpoint.evolveum.com/xml/ns/public/connector/icf-1/connector-schema-3](http://midpoint.evolveum.com/xml/ns/public/connector/icf-1/connector-schema-3)"
                                  xmlns:cfg="[http://midpoint.evolveum.com/xml/ns/public/connector/icf-1/bundle/connector-koha/com.identicum.connectors.KohaConnector](http://midpoint.evolveum.com/xml/ns/public/connector/icf-1/bundle/connector-koha/com.identicum.connectors.KohaConnector)"&gt;

        &lt;cfg:serviceAddress&gt;http://TU_URL_DE_KOHA&lt;/cfg:serviceAddress&gt;

        &lt;cfg:authenticationMethodStrategy&gt;OAUTH2&lt;/cfg:authenticationMethodStrategy&gt;
        
        &lt;cfg:clientId&gt;TU_CLIENT_ID&lt;/cfg:clientId&gt;
        &lt;cfg:clientSecret&gt;
            &lt;t:clearValue&gt;TU_CLIENT_SECRET&lt;/t:clearValue&gt;
        &lt;/cfg:clientSecret&gt;

        &lt;cfg:trustAllCertificates&gt;false&lt;/cfg:trustAllCertificates&gt;
        
    &lt;/icfc:configurationProperties&gt;
&lt;/connectorConfiguration&gt;
<br class="ProseMirror-trailingBreak"></code></pre><p>Para una gu√≠a completa sobre c√≥mo mapear los atributos del <strong>Esquema de Extensi√≥n UPeU</strong> a los atributos de este conector, consulta la documentaci√≥n del esquema.</p><h2>üèõÔ∏è Arquitectura del Conector</h2><p>El c√≥digo fuente del conector sigue una arquitectura modular para separar responsabilidades:</p><ul><li><p><strong><code>KohaConnector.java</code></strong>: Act√∫a como el orquestador principal que implementa las interfaces de ConnId.</p></li><li><p><strong><code>KohaAuthenticator.java</code></strong>: Centraliza la l√≥gica de autenticaci√≥n.</p></li><li><p><strong>Paquete <code>services</code></strong>: Gestiona la comunicaci√≥n con los endpoints espec√≠ficos de la API de Koha, extendiendo funcionalidades de una clase base abstracta (<code>AbstractKohaService.java</code>) que maneja la l√≥gica HTTP com√∫n y el manejo de errores mejorado.</p></li><li><p><strong>Paquete <code>mappers</code></strong>: Se encarga de la transformaci√≥n de datos entre Midpoint y el formato JSON de Koha.</p></li></ul><h2>üêõ Troubleshooting</h2><p>Para obtener informaci√≥n de diagn√≥stico detallada, puedes habilitar el logging <code>TRACE</code> o <code>DEBUG</code> para este conector en Midpoint. Esto es especialmente √∫til si encuentras problemas durante la configuraci√≥n o la ejecuci√≥n de operaciones.</p><p>A√±ade la siguiente configuraci√≥n a tu archivo de logging de Midpoint (generalmente <code>logback.xml</code> o un archivo similar referenciado en la configuraci√≥n de logging de Midpoint):</p><pre><code>&lt;logger name="com.identicum.connectors" level="TRACE"/&gt;
<br class="ProseMirror-trailingBreak"></code></pre><p>Opciones de nivel de log:</p><ul><li><p><code>ERROR</code>: Solo errores cr√≠ticos que impiden el funcionamiento.</p></li><li><p><code>WARN</code>: Advertencias sobre situaciones potencialmente problem√°ticas.</p></li><li><p><code>INFO</code>: Mensajes informativos generales sobre el flujo de operaciones (por defecto para muchas operaciones del conector).</p></li><li><p><code>DEBUG</code>: Informaci√≥n detallada √∫til para depurar el flujo de control y las solicitudes/respuestas b√°sicas.</p></li><li><p><code>TRACE</code>: El nivel m√°s detallado, incluye payloads de solicitud/respuesta, transformaciones de atributos, etc. Puede generar mucho output.</p></li></ul><p>Revisa los logs de Midpoint para ver los mensajes detallados del conector. Esto te ayudar√° a ti o a los desarrolladores a entender qu√© est√° sucediendo.</p><h2>üìú Historial de Versiones</h2><h3>v1.0.1 (08 de Julio de 2025)</h3><ul><li><p><strong>FIX:</strong> Se corrigieron errores de compilaci√≥n y ejecuci√≥n de pruebas que imped√≠an empaquetar el proyecto.</p></li><li><p><strong>FIX:</strong> Se ajust√≥ la configuraci√≥n de pruebas (<code>KohaConnectorIntegrationTest</code>) para usar inyecci√≥n de dependencias de Mockito (<code>@InjectMocks</code>) y resolver <code>NullPointerException</code>.</p></li><li><p><strong>CHORE:</strong> Se actualiz√≥ la configuraci√≥n de compilaci√≥n y pruebas para ser compatible con JDK 17, resolviendo conflictos con versiones m√°s recientes de Java.</p></li><li><p><strong>DOCS:</strong> Se a√±adi√≥ la secci√≥n de "Requisitos Previos" al <code>README.md</code> para especificar las versiones de Java compatibles.</p></li></ul><h3>v1.0.0</h3><ul><li><p>Lanzamiento inicial del conector.</p></li><li><p>Soporte completo para operaciones CRUD (Create, Read, Update, Delete) para Patrones de Koha.</p></li><li><p>Implementaci√≥n de autenticaci√≥n B√°sica y OAuth2 (Client Credentials).</p></li></ul><h2>‚öñÔ∏è Licencia</h2><p>Este proyecto est√° bajo la Licencia Apache 2.0. Consulta el archivo <code>LICENSE</code> para m√°s detalles.</p><h2>ü§ù Contribuciones</h2><p>Las contribuciones son bienvenidas. Para cambios mayores, por favor, abre un "issue" primero para discutir lo que te gustar√≠a cambiar.</p></div>